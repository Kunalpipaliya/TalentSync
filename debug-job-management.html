<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Job Management - TalentSync</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>
<body>
    <div style="padding: 20px;">
        <h1>Debug Job Management</h1>
        
        <div style="margin: 20px 0;">
            <h2>Test Buttons</h2>
            <button onclick="testManageJob()" class="btn btn-primary">Test Manage Job Function</button>
            <button onclick="testModalSystem()" class="btn btn-outline">Test Modal System</button>
            <button onclick="checkDashboardObject()" class="btn btn-secondary">Check Dashboard Object</button>
        </div>
        
        <div style="margin: 20px 0;">
            <h2>Create Test Job</h2>
            <button onclick="createTestJob()" class="btn btn-success">Create Test Job</button>
            <div id="test-job-id" style="margin-top: 10px; font-weight: bold;"></div>
        </div>
        
        <div style="margin: 20px 0;">
            <h2>Test Job Card</h2>
            <div id="test-job-card"></div>
        </div>
        
        <div id="logs" style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px;">
            <h3>Debug Logs:</h3>
        </div>
    </div>
    
    <!-- Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay"></div>
    
    <script src="firebase-config.js"></script>
    <script src="script.js"></script>
    <script src="dashboard.js"></script>
    
    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            logs.appendChild(logEntry);
            console.log(message);
        }
        
        function testManageJob() {
            log('Testing manageJob function...');
            
            // Check if dashboard object exists
            if (typeof dashboard === 'undefined') {
                log('‚ùå Dashboard object not found!');
                return;
            }
            
            // Check if manageJob function exists
            if (typeof dashboard.manageJob !== 'function') {
                log('‚ùå manageJob function not found on dashboard object!');
                return;
            }
            
            log('‚úÖ Dashboard object and manageJob function found');
            
            // Test with a dummy job ID
            try {
                dashboard.manageJob('test-job-123');
                log('‚úÖ manageJob function called successfully');
            } catch (error) {
                log('‚ùå Error calling manageJob: ' + error.message);
            }
        }
        
        function testModalSystem() {
            log('Testing modal system...');
            
            // Check if talentSync exists
            if (typeof talentSync === 'undefined') {
                log('‚ùå talentSync object not found!');
                return;
            }
            
            // Check if showModal function exists
            if (typeof talentSync.showModal !== 'function') {
                log('‚ùå showModal function not found on talentSync object!');
                return;
            }
            
            log('‚úÖ TalentSync object and showModal function found');
            
            // Test modal
            const testModalHTML = `
                <div class="modal">
                    <div class="modal-header">
                        <h2 class="modal-title">Test Modal</h2>
                        <button class="modal-close" onclick="talentSync.closeModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>This is a test modal to verify the modal system is working.</p>
                        <button class="btn btn-primary" onclick="talentSync.closeModal()">Close</button>
                    </div>
                </div>
            `;
            
            try {
                talentSync.showModal(testModalHTML);
                log('‚úÖ Test modal displayed successfully');
            } catch (error) {
                log('‚ùå Error showing test modal: ' + error.message);
            }
        }
        
        function checkDashboardObject() {
            log('Checking dashboard object...');
            
            if (typeof dashboard === 'undefined') {
                log('‚ùå Dashboard object not defined');
                return;
            }
            
            log('‚úÖ Dashboard object exists');
            log('Dashboard methods: ' + Object.getOwnPropertyNames(Object.getPrototypeOf(dashboard)).join(', '));
            
            // Check specific methods
            const requiredMethods = ['manageJob', 'handleJobUpdate', 'deleteJob', 'loadClientJobs'];
            requiredMethods.forEach(method => {
                if (typeof dashboard[method] === 'function') {
                    log(`‚úÖ ${method} method exists`);
                } else {
                    log(`‚ùå ${method} method missing`);
                }
            });
        }
        
        async function createTestJob() {
            log('Creating test job...');
            
            if (!firebaseService || !firebaseService.saveJob) {
                log('‚ùå Firebase service not available');
                return;
            }
            
            const testJob = {
                title: 'Test Job for Management - ' + Date.now(),
                description: 'This is a test job created for debugging job management functionality.',
                category: 'web-development',
                budgetType: 'fixed',
                budgetMin: 1000,
                budgetMax: 2000,
                experience: 'intermediate',
                duration: 'medium',
                skills: ['JavaScript', 'React', 'Node.js'],
                location: 'Remote',
                status: 'active',
                clientId: 'debug-client-123',
                clientName: 'Debug Client',
                clientAvatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=60&h=60&fit=crop&crop=face',
                clientRating: 4.5,
                clientJobsPosted: 5,
                proposals: 0,
                postedDate: new Date().toISOString()
            };
            
            try {
                const result = await firebaseService.saveJob(testJob);
                if (result.success) {
                    log(`‚úÖ Test job created with ID: ${result.id}`);
                    document.getElementById('test-job-id').textContent = `Job ID: ${result.id}`;
                    
                    // Create a test job card
                    createTestJobCard(result.id, testJob);
                } else {
                    log(`‚ùå Failed to create test job: ${result.error}`);
                }
            } catch (error) {
                log(`‚ùå Error creating test job: ${error.message}`);
            }
        }
        
        function createTestJobCard(jobId, job) {
            const jobCard = `
                <div class="job-card" style="max-width: 500px; margin: 10px 0;">
                    <div class="job-card-header">
                        <div>
                            <h3 class="job-card-title">${job.title}</h3>
                            <div class="job-card-meta">
                                <span><i class="fas fa-paper-plane"></i> ${job.proposals} proposals</span>
                                <span><i class="fas fa-calendar"></i> Posted: ${new Date(job.postedDate).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <span class="badge badge-primary">${job.status}</span>
                    </div>
                    <div class="job-card-footer">
                        <span class="job-card-budget">$${job.budgetMin} - $${job.budgetMax}</span>
                        <div>
                            <button class="btn btn-outline btn-sm" onclick="log('View button clicked')">View</button>
                            <button class="btn btn-primary btn-sm" onclick="testManageJobWithId('${jobId}')">Manage</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('test-job-card').innerHTML = jobCard;
        }
        
        function testManageJobWithId(jobId) {
            log(`Testing manageJob with real job ID: ${jobId}`);
            
            if (typeof dashboard !== 'undefined' && typeof dashboard.manageJob === 'function') {
                try {
                    dashboard.manageJob(jobId);
                    log('‚úÖ manageJob called with real job ID');
                } catch (error) {
                    log(`‚ùå Error calling manageJob with real ID: ${error.message}`);
                }
            } else {
                log('‚ùå Dashboard or manageJob not available');
            }
        }
        
        // Initialize when page loads
        window.addEventListener('load', () => {
            log('üöÄ Debug page loaded');
            
            // Wait for scripts to load
            setTimeout(() => {
                checkDashboardObject();
            }, 2000);
        });
    </script>
</body>
</html>